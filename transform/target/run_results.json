{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.8.9", "generated_at": "2024-12-11T12:00:15.161149Z", "invocation_id": "f448c611-d713-4852-9027-d95b22ff457b", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2024-12-11T12:00:14.776293Z", "completed_at": "2024-12-11T12:00:14.781341Z"}, {"name": "execute", "started_at": "2024-12-11T12:00:14.781558Z", "completed_at": "2024-12-11T12:00:14.832874Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0695338249206543, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.transform.3_1", "compiled": true, "compiled_code": "SELECT \n    strftime('%Y-%m', Date) AS mois,  -- Utilisation de strftime pour extraire l'ann\u00e9e et le mois\n    \"R\u00e9gion\", \n    SUM(COALESCE(TRY_CAST(\"consommation\" AS INT), 0))/2000 AS consommation_totale_en_GWH,\n    SUM(COALESCE(production_totale, 0))/2000 AS production_totale_en_GWH,\n\n    MIN(COALESCE(TRY_CAST(\"consommation\" AS INT), 0)) AS min_consommation_totale,\n    MIN(COALESCE(production_totale, 0)) AS min_production_totale,\n\n    MAX(COALESCE(TRY_CAST(\"consommation\" AS INT), 0)) AS max_consommation_totale,\n    MAX(COALESCE(production_totale, 0)) AS max_production_totale,\n    \n    AVG(COALESCE(TRY_CAST(\"consommation\" AS INT), 0)) AS moyenne_consommation_totale,\n\n    AVG(COALESCE(production_totale, 0)) AS moyenne_production_totale\nFROM clean\nGROUP BY strftime('%Y-%m', Date), \"R\u00e9gion\"  -- Remplacer TO_CHAR par strftime\nORDER BY mois, \"R\u00e9gion\"  -- Tri par mois et r\u00e9gion", "relation_name": "\"dev\".\"main\".\"3_1\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-12-11T12:00:14.847568Z", "completed_at": "2024-12-11T12:00:14.849403Z"}, {"name": "execute", "started_at": "2024-12-11T12:00:14.849609Z", "completed_at": "2024-12-11T12:00:14.877097Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.041649580001831055, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.transform.3_3", "compiled": true, "compiled_code": "WITH data_with_consumption AS (\n    SELECT \n        \"Code INSEE r\u00e9gion\",\n        \"R\u00e9gion\", \n        \"Date\", \n        consommation,  -- Consommation en MW\n        -- Calcul de la consommation cumul\u00e9e en GWh pour chaque jour du mois \u00e9coul\u00e9\n        SUM(COALESCE(consommation, 0)) OVER (\n            PARTITION BY \"R\u00e9gion\", EXTRACT(YEAR FROM \"Date\"), EXTRACT(MONTH FROM \"Date\")\n            ORDER BY \"Date\"\n            RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW\n        ) / 2000 AS consommation_gwh  -- Conversion de la consommation en GWh\n    FROM clean\n)\n\nSELECT \n    \"Code INSEE r\u00e9gion\", \n    \"R\u00e9gion\", \n    \"Date\", \n    consommation, \n    consommation_gwh\nFROM data_with_consumption\nORDER BY \"R\u00e9gion\", \"Date\"", "relation_name": "\"dev\".\"main\".\"3_3\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-12-11T12:00:14.890597Z", "completed_at": "2024-12-11T12:00:14.892261Z"}, {"name": "execute", "started_at": "2024-12-11T12:00:14.892470Z", "completed_at": "2024-12-11T12:00:14.916856Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.03831791877746582, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.transform.clean", "compiled": true, "compiled_code": "WITH data_clean AS (\n    SELECT \n        *,\n        COALESCE(TRY_CAST(\"Consommation (MW)\" AS INT), 0) AS consommation,\n        COALESCE(TRY_CAST(\"Eolien (MW)\" AS INT), 0) AS eolien,\n        COALESCE(TRY_CAST(\"Thermique (MW)\" AS INT), 0) AS thermique,\n        COALESCE(TRY_CAST(\"Bio\u00e9nergies (MW)\" AS INT), 0) AS bioenergies,\n        COALESCE(TRY_CAST(\"Nucl\u00e9aire (MW)\" AS INT), 0) AS nucleaire,\n        COALESCE(TRY_CAST(\"Solaire (MW)\" AS INT), 0) AS solaire,\n        COALESCE(TRY_CAST(\"Hydraulique (MW)\" AS INT), 0) AS hydraulique,\n        COALESCE(TRY_CAST(\"Pompage (MW)\" AS INT), 0) AS pompage,\n        COALESCE(TRY_CAST(\"Ech. physiques (MW)\" AS INT), 0) AS ech_physiques\n    FROM eco2\n    WHERE \"R\u00e9gion\" IS NOT NULL AND \"Date\" IS NOT NULL\n),\ndata_final AS (\n    SELECT \n        \"Code INSEE r\u00e9gion\",\n        \"R\u00e9gion\", \n        \"Date\", \n        \"Heure\",\n        consommation,\n        eolien,\n        thermique,\n        bioenergies,\n        nucleaire,\n        solaire,\n        hydraulique,\n        pompage,\n        ech_physiques,\n        COALESCE(nucleaire, 0) + \n        COALESCE(eolien, 0) +\n        COALESCE(solaire, 0) +\n        COALESCE(hydraulique, 0) +\n        COALESCE(thermique, 0) AS production_totale\n    FROM data_clean\n)\n\nSELECT * FROM data_final", "relation_name": "\"dev\".\"main\".\"clean\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-12-11T12:00:14.930473Z", "completed_at": "2024-12-11T12:00:14.957500Z"}, {"name": "execute", "started_at": "2024-12-11T12:00:14.957745Z", "completed_at": "2024-12-11T12:00:14.982430Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.06514763832092285, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.transform.grain_jour", "compiled": true, "compiled_code": "WITH data_clean AS (\n    SELECT *\n    from clean\n          \n)\nSELECT \n    \"Date\", \n    \"R\u00e9gion\", \n    SUM(COALESCE(TRY_CAST(\"consommation\" AS INT), 0)) AS consommation_totale,\n    SUM(COALESCE(TRY_CAST(\"thermique\" AS INT), 0)) AS thermique_total,\n    SUM(COALESCE(TRY_CAST(\"bioenergies\" AS INT), 0)) AS bioenergies_total,\n    SUM(COALESCE(TRY_CAST(\"eolien\" AS INT), 0)) AS eolien_total,\n    SUM(COALESCE(TRY_CAST(\"nucleaire\" AS INT), 0)) AS nucleaire_total,\n    SUM(COALESCE(TRY_CAST(\"solaire\" AS INT), 0)) AS solaire_total,\n    SUM(COALESCE(TRY_CAST(\"hydraulique\" AS INT), 0)) AS hydraulique_total,\n    SUM(COALESCE(TRY_CAST(\"pompage\" AS INT), 0)) AS pompage_total,\n    SUM(COALESCE(TRY_CAST(\"ech_physiques\" AS INT), 0)) AS ech_physiques_total,\n    SUM(COALESCE(TRY_CAST(\"production_totale\" AS INT), 0)) AS production_totale\n   \nFROM data_clean\nGROUP BY \"Date\", \"R\u00e9gion\"\nORDER BY \"Date\", \"R\u00e9gion\"", "relation_name": "\"dev\".\"main\".\"grain_jour\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-12-11T12:00:14.998541Z", "completed_at": "2024-12-11T12:00:15.001635Z"}, {"name": "execute", "started_at": "2024-12-11T12:00:15.001971Z", "completed_at": "2024-12-11T12:00:15.039831Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.05663299560546875, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.transform.my_first_dbt_model", "compiled": true, "compiled_code": "/*\n    Welcome to your first dbt model!\n    Did you know that you can also configure models directly within SQL files?\n    This will override configurations stated in dbt_project.yml\n\n    Try changing \"table\" to \"view\" below\n*/\n\n\n\nwith source_data as (\n\n    select 1 as id\n    union all\n    select null as id\n\n)\n\nselect *\nfrom source_data\n\n/*\n    Uncomment the line below to remove records with null `id` values\n*/\n\n-- where id is not null", "relation_name": "\"dev\".\"main\".\"my_first_dbt_model\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-12-11T12:00:15.056633Z", "completed_at": "2024-12-11T12:00:15.059791Z"}, {"name": "execute", "started_at": "2024-12-11T12:00:15.060004Z", "completed_at": "2024-12-11T12:00:15.085896Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.04169893264770508, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.transform.3_2", "compiled": true, "compiled_code": "-- R\u00e9cup\u00e9rer les r\u00e9gions distinctes dans un set Jinja\n\n\nSELECT \n    Date,\n    \n    \n        -- On s'assure que les noms de r\u00e9gions contenant des caract\u00e8res sp\u00e9ciaux sont correctement \u00e9chapp\u00e9s\n        SUM(CASE WHEN \"R\u00e9gion\" = 'Bourgogne-Franche-Comt\u00e9' THEN COALESCE(CAST(\"consommation\" AS INT), 0) / 2000 ELSE 0 END) AS \"Bourgogne-Franche-Comt\u00e9\"\n        , \n    \n        -- On s'assure que les noms de r\u00e9gions contenant des caract\u00e8res sp\u00e9ciaux sont correctement \u00e9chapp\u00e9s\n        SUM(CASE WHEN \"R\u00e9gion\" = 'Centre-Val de Loire' THEN COALESCE(CAST(\"consommation\" AS INT), 0) / 2000 ELSE 0 END) AS \"Centre-Val de Loire\"\n        , \n    \n        -- On s'assure que les noms de r\u00e9gions contenant des caract\u00e8res sp\u00e9ciaux sont correctement \u00e9chapp\u00e9s\n        SUM(CASE WHEN \"R\u00e9gion\" = 'Nouvelle-Aquitaine' THEN COALESCE(CAST(\"consommation\" AS INT), 0) / 2000 ELSE 0 END) AS \"Nouvelle-Aquitaine\"\n        , \n    \n        -- On s'assure que les noms de r\u00e9gions contenant des caract\u00e8res sp\u00e9ciaux sont correctement \u00e9chapp\u00e9s\n        SUM(CASE WHEN \"R\u00e9gion\" = 'Occitanie' THEN COALESCE(CAST(\"consommation\" AS INT), 0) / 2000 ELSE 0 END) AS \"Occitanie\"\n        , \n    \n        -- On s'assure que les noms de r\u00e9gions contenant des caract\u00e8res sp\u00e9ciaux sont correctement \u00e9chapp\u00e9s\n        SUM(CASE WHEN \"R\u00e9gion\" = '\u00cele-de-France' THEN COALESCE(CAST(\"consommation\" AS INT), 0) / 2000 ELSE 0 END) AS \"\u00cele-de-France\"\n        , \n    \n        -- On s'assure que les noms de r\u00e9gions contenant des caract\u00e8res sp\u00e9ciaux sont correctement \u00e9chapp\u00e9s\n        SUM(CASE WHEN \"R\u00e9gion\" = 'Normandie' THEN COALESCE(CAST(\"consommation\" AS INT), 0) / 2000 ELSE 0 END) AS \"Normandie\"\n        , \n    \n        -- On s'assure que les noms de r\u00e9gions contenant des caract\u00e8res sp\u00e9ciaux sont correctement \u00e9chapp\u00e9s\n        SUM(CASE WHEN \"R\u00e9gion\" = 'Grand Est' THEN COALESCE(CAST(\"consommation\" AS INT), 0) / 2000 ELSE 0 END) AS \"Grand Est\"\n        , \n    \n        -- On s'assure que les noms de r\u00e9gions contenant des caract\u00e8res sp\u00e9ciaux sont correctement \u00e9chapp\u00e9s\n        SUM(CASE WHEN \"R\u00e9gion\" = 'Provence-Alpes-C\u00f4te d''Azur' THEN COALESCE(CAST(\"consommation\" AS INT), 0) / 2000 ELSE 0 END) AS \"Provence-Alpes-C\u00f4te d''Azur\"\n        , \n    \n        -- On s'assure que les noms de r\u00e9gions contenant des caract\u00e8res sp\u00e9ciaux sont correctement \u00e9chapp\u00e9s\n        SUM(CASE WHEN \"R\u00e9gion\" = 'Bretagne' THEN COALESCE(CAST(\"consommation\" AS INT), 0) / 2000 ELSE 0 END) AS \"Bretagne\"\n        , \n    \n        -- On s'assure que les noms de r\u00e9gions contenant des caract\u00e8res sp\u00e9ciaux sont correctement \u00e9chapp\u00e9s\n        SUM(CASE WHEN \"R\u00e9gion\" = 'Hauts-de-France' THEN COALESCE(CAST(\"consommation\" AS INT), 0) / 2000 ELSE 0 END) AS \"Hauts-de-France\"\n        , \n    \n        -- On s'assure que les noms de r\u00e9gions contenant des caract\u00e8res sp\u00e9ciaux sont correctement \u00e9chapp\u00e9s\n        SUM(CASE WHEN \"R\u00e9gion\" = 'Auvergne-Rh\u00f4ne-Alpes' THEN COALESCE(CAST(\"consommation\" AS INT), 0) / 2000 ELSE 0 END) AS \"Auvergne-Rh\u00f4ne-Alpes\"\n        , \n    \n        -- On s'assure que les noms de r\u00e9gions contenant des caract\u00e8res sp\u00e9ciaux sont correctement \u00e9chapp\u00e9s\n        SUM(CASE WHEN \"R\u00e9gion\" = 'Pays de la Loire' THEN COALESCE(CAST(\"consommation\" AS INT), 0) / 2000 ELSE 0 END) AS \"Pays de la Loire\"\n        \n    \n    \nFROM \n    \"dev\".\"main\".\"clean\"\nGROUP BY \n    Date\nORDER BY \n    Date", "relation_name": "\"dev\".\"main\".\"3_2\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-12-11T12:00:15.101859Z", "completed_at": "2024-12-11T12:00:15.104228Z"}, {"name": "execute", "started_at": "2024-12-11T12:00:15.104446Z", "completed_at": "2024-12-11T12:00:15.129877Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.040982961654663086, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.transform.my_second_dbt_model", "compiled": true, "compiled_code": "-- Use the `ref` function to select from other models\n\nselect *\nfrom \"dev\".\"main\".\"my_first_dbt_model\"\nwhere id = 1", "relation_name": "\"dev\".\"main\".\"my_second_dbt_model\""}], "elapsed_time": 0.7670688629150391, "args": {"log_format_file": "debug", "log_level_file": "debug", "defer": false, "favor_state": false, "source_freshness_run_project_hooks": false, "require_resource_names_without_spaces": false, "which": "run", "quiet": false, "project_dir": "/home/ETUDIANT/e24a518u/Bureau/tp sql/transform", "require_explicit_package_overrides_for_builtin_materializations": true, "indirect_selection": "eager", "log_path": "/home/ETUDIANT/e24a518u/Bureau/tp sql/transform/logs", "log_file_max_bytes": 10485760, "log_level": "info", "vars": {}, "strict_mode": false, "macro_debugging": false, "show_resource_report": false, "static_parser": true, "version_check": true, "select": [], "cache_selected_only": false, "write_json": true, "printer_width": 80, "invocation_command": "dbt run", "partial_parse": true, "empty": false, "enable_legacy_logger": false, "send_anonymous_usage_stats": true, "warn_error_options": {"include": [], "exclude": []}, "populate_cache": true, "log_format": "default", "print": true, "profiles_dir": "/home/ETUDIANT/e24a518u/.dbt", "use_colors": true, "exclude": [], "use_colors_file": true, "partial_parse_file_diff": true, "introspect": true}}