{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.8.9", "generated_at": "2024-12-16T11:50:53.129994Z", "invocation_id": "da4042cf-9b99-438a-a0ad-5da037b1f5b0", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2024-12-16T11:50:52.345177Z", "completed_at": "2024-12-16T11:50:52.352505Z"}, {"name": "execute", "started_at": "2024-12-16T11:50:52.352734Z", "completed_at": "2024-12-16T11:50:52.430910Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.09856009483337402, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.transform.clean", "compiled": true, "compiled_code": "WITH data_clean AS (\n    SELECT \n        *,\n        COALESCE(TRY_CAST(\"Consommation (MW)\" AS INT), 0) AS consommation,\n        COALESCE(TRY_CAST(\"Eolien (MW)\" AS INT), 0) AS eolien,\n        COALESCE(TRY_CAST(\"Thermique (MW)\" AS INT), 0) AS thermique,\n        COALESCE(TRY_CAST(\"Bio\u00e9nergies (MW)\" AS INT), 0) AS bioenergies,\n        COALESCE(TRY_CAST(\"Nucl\u00e9aire (MW)\" AS INT), 0) AS nucleaire,\n        COALESCE(TRY_CAST(\"Solaire (MW)\" AS INT), 0) AS solaire,\n        COALESCE(TRY_CAST(\"Hydraulique (MW)\" AS INT), 0) AS hydraulique,\n        COALESCE(TRY_CAST(\"Pompage (MW)\" AS INT), 0) AS pompage,\n        COALESCE(TRY_CAST(\"Ech. physiques (MW)\" AS INT), 0) AS ech_physiques\n    FROM eco2\n    WHERE \"R\u00e9gion\" IS NOT NULL AND \"Date\" IS NOT NULL\n),\ndata_final AS (\n    SELECT \n        \"Code INSEE r\u00e9gion\",\n        \"R\u00e9gion\", \n        \"Date\", \n        \"Heure\",\n        consommation,\n        eolien,\n        thermique,\n        bioenergies,\n        nucleaire,\n        solaire,\n        hydraulique,\n        pompage,\n        ech_physiques,\n        COALESCE(nucleaire, 0) + \n        COALESCE(eolien, 0) +\n        COALESCE(solaire, 0) +\n        COALESCE(hydraulique, 0) +\n        COALESCE(thermique, 0) AS production_totale\n    FROM data_clean\n)\n\nSELECT * FROM data_final", "relation_name": "\"dev\".\"main\".\"clean\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-12-16T11:50:52.445667Z", "completed_at": "2024-12-16T11:50:52.447379Z"}, {"name": "execute", "started_at": "2024-12-16T11:50:52.447606Z", "completed_at": "2024-12-16T11:50:52.472543Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.03907465934753418, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.transform.grain_jour", "compiled": true, "compiled_code": "WITH data_clean AS (\n    SELECT *\n    from clean\n          \n)\nSELECT \n    \"Date\", \n    \"R\u00e9gion\", \n    SUM(COALESCE(TRY_CAST(\"consommation\" AS INT), 0)) AS consommation_totale,\n    SUM(COALESCE(TRY_CAST(\"thermique\" AS INT), 0)) AS thermique_total,\n    SUM(COALESCE(TRY_CAST(\"bioenergies\" AS INT), 0)) AS bioenergies_total,\n    SUM(COALESCE(TRY_CAST(\"eolien\" AS INT), 0)) AS eolien_total,\n    SUM(COALESCE(TRY_CAST(\"nucleaire\" AS INT), 0)) AS nucleaire_total,\n    SUM(COALESCE(TRY_CAST(\"solaire\" AS INT), 0)) AS solaire_total,\n    SUM(COALESCE(TRY_CAST(\"hydraulique\" AS INT), 0)) AS hydraulique_total,\n    SUM(COALESCE(TRY_CAST(\"pompage\" AS INT), 0)) AS pompage_total,\n    SUM(COALESCE(TRY_CAST(\"ech_physiques\" AS INT), 0)) AS ech_physiques_total,\n    SUM(COALESCE(TRY_CAST(\"production_totale\" AS INT), 0)) AS production_totale\n   \nFROM data_clean\nGROUP BY \"Date\", \"R\u00e9gion\"\nORDER BY \"Date\", \"R\u00e9gion\"", "relation_name": "\"dev\".\"main\".\"grain_jour\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-12-16T11:50:52.486248Z", "completed_at": "2024-12-16T11:50:52.488436Z"}, {"name": "execute", "started_at": "2024-12-16T11:50:52.488782Z", "completed_at": "2024-12-16T11:50:52.523526Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.05168867111206055, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.transform.my_first_dbt_model", "compiled": true, "compiled_code": "/*\n    Welcome to your first dbt model!\n    Did you know that you can also configure models directly within SQL files?\n    This will override configurations stated in dbt_project.yml\n\n    Try changing \"table\" to \"view\" below\n*/\n\n\n\nwith source_data as (\n\n    select 1 as id\n    union all\n    select null as id\n\n)\n\nselect *\nfrom source_data\n\n/*\n    Uncomment the line below to remove records with null `id` values\n*/\n\n-- where id is not null", "relation_name": "\"dev\".\"main\".\"my_first_dbt_model\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-12-16T11:50:52.539507Z", "completed_at": "2024-12-16T11:50:52.541101Z"}, {"name": "execute", "started_at": "2024-12-16T11:50:52.541326Z", "completed_at": "2024-12-16T11:50:52.625398Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.09878945350646973, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.transform.temp", "compiled": true, "compiled_code": "WITH raw_data AS (\n    SELECT \n        *\n    FROM read_csv_auto('/home/ETUDIANT/e24a518u/Bureau/tp sql/transform/temperature-quotidienne-regionale.csv')  -- Sp\u00e9cifiez le chemin vers votre CSV\n)\n-- Cr\u00e9e la table dans DuckDB avec les donn\u00e9es du CSV\nSELECT \n    ID,\n    Date,\n    \"Code INSEE r\u00e9gion\" AS code_insee_region,\n    R\u00e9gion,\n    \"TMin (\u00b0C)\" AS tmin,\n    \"TMax (\u00b0C)\" AS tmax,\n    \"TMoy (\u00b0C)\" AS tmoy\nFROM raw_data", "relation_name": "\"dev\".\"main\".\"temp\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-12-16T11:50:52.639863Z", "completed_at": "2024-12-16T11:50:52.642053Z"}, {"name": "execute", "started_at": "2024-12-16T11:50:52.642267Z", "completed_at": "2024-12-16T11:50:52.671319Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.04352068901062012, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.transform.3_1", "compiled": true, "compiled_code": "SELECT \n    strftime('%Y-%m', Date) AS mois,  -- Utilisation de strftime pour extraire l'ann\u00e9e et le mois\n    \"R\u00e9gion\", \n    SUM(COALESCE(TRY_CAST(\"consommation\" AS INT), 0))/2000 AS consommation_totale_en_GWH,\n    SUM(COALESCE(production_totale, 0))/2000 AS production_totale_en_GWH,\n\n    MIN(COALESCE(TRY_CAST(\"consommation\" AS INT), 0)) AS min_consommation_totale,\n    MIN(COALESCE(production_totale, 0)) AS min_production_totale,\n\n    MAX(COALESCE(TRY_CAST(\"consommation\" AS INT), 0)) AS max_consommation_totale,\n    MAX(COALESCE(production_totale, 0)) AS max_production_totale,\n    \n    AVG(COALESCE(TRY_CAST(\"consommation\" AS INT), 0)) AS moyenne_consommation_totale,\n\n    AVG(COALESCE(production_totale, 0)) AS moyenne_production_totale\n   from  \"dev\".\"main\".\"clean\"\nGROUP BY strftime('%Y-%m', Date), \"R\u00e9gion\"  -- Remplacer TO_CHAR par strftime\nORDER BY mois, \"R\u00e9gion\"  -- Tri par mois et r\u00e9gion", "relation_name": "\"dev\".\"main\".\"3_1\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-12-16T11:50:52.684928Z", "completed_at": "2024-12-16T11:50:52.688061Z"}, {"name": "execute", "started_at": "2024-12-16T11:50:52.688284Z", "completed_at": "2024-12-16T11:50:52.713245Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0404355525970459, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.transform.3_2", "compiled": true, "compiled_code": "-- R\u00e9cup\u00e9rer les r\u00e9gions distinctes dans un set Jinja\n\n\nSELECT \n    Date,\n    \n    \n        -- On s'assure que les noms de r\u00e9gions contenant des caract\u00e8res sp\u00e9ciaux sont correctement \u00e9chapp\u00e9s\n        SUM(CASE WHEN \"R\u00e9gion\" = 'Bourgogne-Franche-Comt\u00e9' THEN COALESCE(CAST(\"consommation\" AS INT), 0) / 2000 ELSE 0 END) AS \"Bourgogne-Franche-Comt\u00e9\"\n        , \n    \n        -- On s'assure que les noms de r\u00e9gions contenant des caract\u00e8res sp\u00e9ciaux sont correctement \u00e9chapp\u00e9s\n        SUM(CASE WHEN \"R\u00e9gion\" = 'Centre-Val de Loire' THEN COALESCE(CAST(\"consommation\" AS INT), 0) / 2000 ELSE 0 END) AS \"Centre-Val de Loire\"\n        , \n    \n        -- On s'assure que les noms de r\u00e9gions contenant des caract\u00e8res sp\u00e9ciaux sont correctement \u00e9chapp\u00e9s\n        SUM(CASE WHEN \"R\u00e9gion\" = 'Nouvelle-Aquitaine' THEN COALESCE(CAST(\"consommation\" AS INT), 0) / 2000 ELSE 0 END) AS \"Nouvelle-Aquitaine\"\n        , \n    \n        -- On s'assure que les noms de r\u00e9gions contenant des caract\u00e8res sp\u00e9ciaux sont correctement \u00e9chapp\u00e9s\n        SUM(CASE WHEN \"R\u00e9gion\" = 'Occitanie' THEN COALESCE(CAST(\"consommation\" AS INT), 0) / 2000 ELSE 0 END) AS \"Occitanie\"\n        , \n    \n        -- On s'assure que les noms de r\u00e9gions contenant des caract\u00e8res sp\u00e9ciaux sont correctement \u00e9chapp\u00e9s\n        SUM(CASE WHEN \"R\u00e9gion\" = '\u00cele-de-France' THEN COALESCE(CAST(\"consommation\" AS INT), 0) / 2000 ELSE 0 END) AS \"\u00cele-de-France\"\n        , \n    \n        -- On s'assure que les noms de r\u00e9gions contenant des caract\u00e8res sp\u00e9ciaux sont correctement \u00e9chapp\u00e9s\n        SUM(CASE WHEN \"R\u00e9gion\" = 'Normandie' THEN COALESCE(CAST(\"consommation\" AS INT), 0) / 2000 ELSE 0 END) AS \"Normandie\"\n        , \n    \n        -- On s'assure que les noms de r\u00e9gions contenant des caract\u00e8res sp\u00e9ciaux sont correctement \u00e9chapp\u00e9s\n        SUM(CASE WHEN \"R\u00e9gion\" = 'Grand Est' THEN COALESCE(CAST(\"consommation\" AS INT), 0) / 2000 ELSE 0 END) AS \"Grand Est\"\n        , \n    \n        -- On s'assure que les noms de r\u00e9gions contenant des caract\u00e8res sp\u00e9ciaux sont correctement \u00e9chapp\u00e9s\n        SUM(CASE WHEN \"R\u00e9gion\" = 'Provence-Alpes-C\u00f4te d''Azur' THEN COALESCE(CAST(\"consommation\" AS INT), 0) / 2000 ELSE 0 END) AS \"Provence-Alpes-C\u00f4te d''Azur\"\n        , \n    \n        -- On s'assure que les noms de r\u00e9gions contenant des caract\u00e8res sp\u00e9ciaux sont correctement \u00e9chapp\u00e9s\n        SUM(CASE WHEN \"R\u00e9gion\" = 'Bretagne' THEN COALESCE(CAST(\"consommation\" AS INT), 0) / 2000 ELSE 0 END) AS \"Bretagne\"\n        , \n    \n        -- On s'assure que les noms de r\u00e9gions contenant des caract\u00e8res sp\u00e9ciaux sont correctement \u00e9chapp\u00e9s\n        SUM(CASE WHEN \"R\u00e9gion\" = 'Hauts-de-France' THEN COALESCE(CAST(\"consommation\" AS INT), 0) / 2000 ELSE 0 END) AS \"Hauts-de-France\"\n        , \n    \n        -- On s'assure que les noms de r\u00e9gions contenant des caract\u00e8res sp\u00e9ciaux sont correctement \u00e9chapp\u00e9s\n        SUM(CASE WHEN \"R\u00e9gion\" = 'Auvergne-Rh\u00f4ne-Alpes' THEN COALESCE(CAST(\"consommation\" AS INT), 0) / 2000 ELSE 0 END) AS \"Auvergne-Rh\u00f4ne-Alpes\"\n        , \n    \n        -- On s'assure que les noms de r\u00e9gions contenant des caract\u00e8res sp\u00e9ciaux sont correctement \u00e9chapp\u00e9s\n        SUM(CASE WHEN \"R\u00e9gion\" = 'Pays de la Loire' THEN COALESCE(CAST(\"consommation\" AS INT), 0) / 2000 ELSE 0 END) AS \"Pays de la Loire\"\n        \n    \n    \nFROM \n    \"dev\".\"main\".\"clean\"\nGROUP BY \n    Date\nORDER BY \n    Date", "relation_name": "\"dev\".\"main\".\"3_2\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-12-16T11:50:52.726924Z", "completed_at": "2024-12-16T11:50:52.729061Z"}, {"name": "execute", "started_at": "2024-12-16T11:50:52.729290Z", "completed_at": "2024-12-16T11:50:52.758830Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.048796653747558594, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.transform.3_3", "compiled": true, "compiled_code": "WITH data_with_consumption AS (\n    SELECT \n        \"Code INSEE r\u00e9gion\",\n        \"R\u00e9gion\", \n        \"Date\", \n        consommation,  -- Consommation en MW\n        -- Calcul de la consommation cumul\u00e9e en GWh pour chaque jour du mois \u00e9coul\u00e9\n        SUM(COALESCE(consommation, 0)) OVER (\n            PARTITION BY \"R\u00e9gion\", EXTRACT(YEAR FROM \"Date\"), EXTRACT(MONTH FROM \"Date\")\n            ORDER BY \"Date\"\n            RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW\n        ) / 2000 AS consommation_gwh  -- Conversion de la consommation en GWh\n    FROM      \"dev\".\"main\".\"clean\"\n\n)\n\nSELECT \n    \"Code INSEE r\u00e9gion\", \n    \"R\u00e9gion\", \n    \"Date\", \n    consommation, \n    consommation_gwh\nFROM data_with_consumption\nORDER BY \"R\u00e9gion\", \"Date\"", "relation_name": "\"dev\".\"main\".\"3_3\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-12-16T11:50:52.782157Z", "completed_at": "2024-12-16T11:50:52.787767Z"}, {"name": "execute", "started_at": "2024-12-16T11:50:52.788798Z", "completed_at": "2024-12-16T11:50:52.845485Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.07724881172180176, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.transform.3_4", "compiled": true, "compiled_code": "WITH daily_consumption AS (\n    SELECT \n        \"R\u00e9gion\",\n        \"Date\",\n        SUM(COALESCE(consommation, 0)) / 2000 AS consommation_gwh  -- Conversion MW \u2192 GWh\n    FROM \"dev\".\"main\".\"clean\"\n    GROUP BY \"R\u00e9gion\", \"Date\"\n),\ndaily_variation AS (\n    SELECT \n        \"R\u00e9gion\",\n        \"Date\",\n        consommation_gwh,\n        consommation_gwh - LAG(consommation_gwh) OVER (\n            PARTITION BY \"R\u00e9gion\"\n            ORDER BY \"Date\"\n        ) AS variation_gwh,\n        CASE \n            WHEN LAG(consommation_gwh) OVER (\n                PARTITION BY \"R\u00e9gion\"\n                ORDER BY \"Date\"\n            ) IS NOT NULL AND LAG(consommation_gwh) OVER (\n                PARTITION BY \"R\u00e9gion\"\n                ORDER BY \"Date\"\n            ) != 0 \n            THEN (consommation_gwh - LAG(consommation_gwh) OVER (\n                    PARTITION BY \"R\u00e9gion\"\n                    ORDER BY \"Date\"\n                )) / LAG(consommation_gwh) OVER (\n                    PARTITION BY \"R\u00e9gion\"\n                    ORDER BY \"Date\"\n                ) * 100\n            ELSE NULL\n        END AS taux_variation_pct\n    FROM daily_consumption\n),\ntop_variations AS (\n    SELECT \n        \"R\u00e9gion\",\n        \"Date\",\n        consommation_gwh,\n        variation_gwh,\n        taux_variation_pct\n    FROM daily_variation\n    WHERE variation_gwh IS NOT NULL  -- Ignore les premi\u00e8res lignes de chaque r\u00e9gion\n    ORDER BY ABS(variation_gwh) DESC  -- Trier par \u00e9cart absolu d\u00e9croissant\n    LIMIT 20\n)\nSELECT *\nFROM top_variations", "relation_name": "\"dev\".\"main\".\"3_4\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-12-16T11:50:52.862717Z", "completed_at": "2024-12-16T11:50:52.867152Z"}, {"name": "execute", "started_at": "2024-12-16T11:50:52.867546Z", "completed_at": "2024-12-16T11:50:52.895748Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.045865535736083984, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.transform.3_5", "compiled": true, "compiled_code": "WITH yearly_renewable_production AS (\n    SELECT\n        EXTRACT(YEAR FROM \"Date\") AS year,\n        SUM(COALESCE(eolien, 0) + \n            COALESCE(solaire, 0) + \n            COALESCE(hydraulique, 0) + \n            COALESCE(bioenergies, 0)) / 2000 AS production_renouvelable_totale_gwh -- Conversion MW \u2192 GWh\n    FROM \"dev\".\"main\".\"clean\"\n    WHERE EXTRACT(YEAR FROM \"Date\") BETWEEN 2013 AND 2022\n    GROUP BY EXTRACT(YEAR FROM \"Date\")\n),\ndaily_cumulative_consumption AS (\n    SELECT\n        EXTRACT(YEAR FROM \"Date\") AS year,\n        \"Date\",\n        SUM(COALESCE(consommation, 0)) / 2000 AS consommation_journaliere_gwh,\n        SUM(SUM(COALESCE(consommation, 0)) / 2000) OVER (\n            PARTITION BY EXTRACT(YEAR FROM \"Date\")\n            ORDER BY \"Date\"\n            ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW\n        ) AS consommation_cumulee_gwh -- Consommation cumul\u00e9e en GWh\n    FROM \"dev\".\"main\".\"clean\"\n    WHERE EXTRACT(YEAR FROM \"Date\") BETWEEN 2013 AND 2022\n    GROUP BY EXTRACT(YEAR FROM \"Date\"), \"Date\"\n),\nthreshold_exceedance AS (\n    SELECT\n        dcc.year,\n        dcc.\"Date\",\n        yrp.production_renouvelable_totale_gwh,\n        dcc.consommation_cumulee_gwh\n    FROM daily_cumulative_consumption dcc\n    JOIN yearly_renewable_production yrp\n        ON dcc.year = yrp.year\n    WHERE dcc.consommation_cumulee_gwh >= yrp.production_renouvelable_totale_gwh\n),\nfirst_exceed_date AS (\n    SELECT\n        year,\n        MIN(\"Date\") AS date_depassement -- Premi\u00e8re date o\u00f9 la consommation d\u00e9passe la production annuelle renouvelable\n    FROM threshold_exceedance\n    GROUP BY year\n)\nSELECT *\nFROM first_exceed_date\nORDER BY year", "relation_name": "\"dev\".\"main\".\"3_5\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-12-16T11:50:52.909387Z", "completed_at": "2024-12-16T11:50:52.911660Z"}, {"name": "execute", "started_at": "2024-12-16T11:50:52.911884Z", "completed_at": "2024-12-16T11:50:52.936703Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.03932762145996094, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.transform.3_6", "compiled": true, "compiled_code": "WITH sequenced_consumption AS (\n    -- Identifie les s\u00e9quences d'augmentation de consommation\n    SELECT\n        CONCAT(\"Date\", ' ', \"Heure\") AS \"Date_Heure\",  -- Combinaison de la date et de l'heure\n        \"R\u00e9gion\",\n        \"consommation\",\n        ROW_NUMBER() OVER (PARTITION BY \"R\u00e9gion\" ORDER BY \"Date\", \"Heure\") AS row_num,\n        CASE \n            WHEN \"consommation\" > LAG(\"consommation\") OVER (PARTITION BY \"R\u00e9gion\" ORDER BY \"Date\", \"Heure\") THEN 0 \n            ELSE 1 \n        END AS is_new_sequence\n    FROM \"dev\".\"main\".\"clean\"\n    WHERE \"consommation\" IS NOT NULL\n),\nsequence_grouped AS (\n    -- Cr\u00e9e les groupes de s\u00e9quences continues\n    SELECT \n        \"Date_Heure\",\n        \"R\u00e9gion\",\n        \"consommation\",\n        row_num,\n        SUM(is_new_sequence) OVER (PARTITION BY \"R\u00e9gion\" ORDER BY row_num ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS sequence_group\n    FROM sequenced_consumption\n),\nsequence_details AS (\n    -- Agr\u00e8ge les s\u00e9quences par groupe et calcule la dur\u00e9e\n    SELECT \n        MIN(CAST(\"Date_Heure\" AS TIMESTAMP)) AS start_datetime,\n        MAX(CAST(\"Date_Heure\" AS TIMESTAMP)) AS end_datetime,\n        \"R\u00e9gion\",\n        ARRAY_AGG(\"consommation\" ORDER BY \"Date_Heure\") AS sequence,\n        COUNT(*) AS sequence_length\n    FROM sequence_grouped\n    GROUP BY \"R\u00e9gion\", sequence_group\n    HAVING COUNT(*) > 1  -- Filtre les s\u00e9quences de plus d'une valeur (augmentation continue)\n),\nranked_sequences AS (\n    -- Classe les s\u00e9quences par longueur d\u00e9croissante et par date de d\u00e9but pour g\u00e9rer les \u00e9galit\u00e9s\n    SELECT \n        start_datetime,\n        end_datetime,\n        \"R\u00e9gion\",\n        sequence,\n        sequence_length,\n        ROW_NUMBER() OVER (PARTITION BY \"R\u00e9gion\" ORDER BY sequence_length DESC, start_datetime) AS rank\n    FROM sequence_details\n)\n-- S\u00e9lectionne les trois plus longues s\u00e9quences\nSELECT \n    start_datetime AS \"Date - Heure\",\n    -- Calcul de la dur\u00e9e manuellement (en heures, minutes, secondes)\n    EXTRACT(HOUR FROM end_datetime - start_datetime) || ':' || \n    LPAD(CAST(EXTRACT(MINUTE FROM end_datetime - start_datetime) AS VARCHAR), 2, '0') || ':' || \n    LPAD(CAST(EXTRACT(SECOND FROM end_datetime - start_datetime) AS VARCHAR), 2, '0') AS \"Dur\u00e9e (hh:mm:ss)\",\n    \"R\u00e9gion\",\n    sequence AS \"S\u00e9quence (MW*)\",\n    rank AS \"Rang\"\nFROM ranked_sequences\nWHERE rank <= 3\nORDER BY \"Rang\", \"R\u00e9gion\"", "relation_name": "\"dev\".\"main\".\"3_6\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-12-16T11:50:52.950411Z", "completed_at": "2024-12-16T11:50:52.952592Z"}, {"name": "execute", "started_at": "2024-12-16T11:50:52.952809Z", "completed_at": "2024-12-16T11:50:52.977279Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.038797616958618164, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.transform.3_7", "compiled": true, "compiled_code": "SELECT\n    \"Date\",\n    strftime('%Y-%m', \"Date\") AS mois,\n    EXTRACT(YEAR FROM \"Date\") AS annee,\n    \"R\u00e9gion\",\n    CASE \n        WHEN \"R\u00e9gion\" IN ('Normandie','Pays de la Loire','Bretagne', 'Centre-Val de Loire') THEN 'NO'\n        WHEN \"R\u00e9gion\" IN ('Grand Est', 'Bourgogne-Franche-Comt\u00e9','Hauts-de-France') THEN 'NE'\n        WHEN \"R\u00e9gion\" IN ('Auvergne-Rh\u00f4ne-Alpes', 'Provence-Alpes-C\u00f4te d''Azur') THEN 'SE'\n        WHEN \"R\u00e9gion\" IN ('Occitanie', 'Nouvelle-Aquitaine') THEN 'SO'\n        ELSE 'IdF' -- Pour les r\u00e9gions sp\u00e9cifiques \u00e0 chaque zone g\u00e9ographique\n    END AS zone,\n    SUM(COALESCE(TRY_CAST(\"consommation\" AS INT), 0)) / 2000 AS consommation_en_GWH\nFROM \n    \"dev\".\"main\".\"clean\"\nWHERE \n    \"R\u00e9gion\" IS NOT NULL\n    AND \"Date\" IS NOT NULL\n    AND \"R\u00e9gion\" != 'Corse'  -- Exclure la Corse\nGROUP BY CUBE(\n    \"Date\", \n    strftime('%Y-%m', \"Date\"), \n    EXTRACT(YEAR FROM \"Date\"), \n    \"R\u00e9gion\", \n    CASE \n        WHEN \"R\u00e9gion\" IN ('Normandie','Pays de la Loire','Bretagne', 'Centre-Val de Loire') THEN 'NO'\n        WHEN \"R\u00e9gion\" IN ('Grand Est', 'Bourgogne-Franche-Comt\u00e9','Hauts-de-France') THEN 'NE'\n        WHEN \"R\u00e9gion\" IN ('Auvergne-Rh\u00f4ne-Alpes', 'Provence-Alpes-C\u00f4te d''Azur') THEN 'SE'\n        WHEN \"R\u00e9gion\" IN ('Occitanie', 'Nouvelle-Aquitaine') THEN 'SO'\n        ELSE 'IdF' \n    END\n)\nHAVING\n    \"R\u00e9gion\" IS NOT NULL AND zone IS NOT NULL\nORDER BY \n    \"Date\", mois, annee, \"R\u00e9gion\", zone", "relation_name": "\"dev\".\"main\".\"3_7\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-12-16T11:50:52.990619Z", "completed_at": "2024-12-16T11:50:52.992704Z"}, {"name": "execute", "started_at": "2024-12-16T11:50:52.992931Z", "completed_at": "2024-12-16T11:50:53.016709Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.03797435760498047, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.transform.my_second_dbt_model", "compiled": true, "compiled_code": "-- Use the `ref` function to select from other models\n\nselect *\nfrom \"dev\".\"main\".\"my_first_dbt_model\"\nwhere id = 1", "relation_name": "\"dev\".\"main\".\"my_second_dbt_model\""}, {"status": "error", "timing": [{"name": "compile", "started_at": "2024-12-16T11:50:53.030121Z", "completed_at": "2024-12-16T11:50:53.032488Z"}, {"name": "execute", "started_at": "2024-12-16T11:50:53.032713Z", "completed_at": "2024-12-16T11:50:53.108192Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.08345627784729004, "adapter_response": {}, "message": "Runtime Error in model clean_temp (models/example/clean_temp.sql)\n  Binder Error: Referenced column \"TMin (\u00b0C)\" not found in FROM clause!\n  Candidate bindings: \"temp.tmin\", \"c.eolien\"\n  LINE 12:         \"TMin (\u00b0C)\" AS tmin,\n                   ^", "failures": null, "unique_id": "model.transform.clean_temp", "compiled": true, "compiled_code": "WITH temperature_data AS (\n    -- Chargement des donn\u00e9es de temp\u00e9rature et s\u00e9lection des informations n\u00e9cessaires\n    SELECT\n        ID,\n        Date,\n        \"Code INSEE r\u00e9gion\" AS code_insee_region,  -- Correction ici : changement de nom de la colonne\n        R\u00e9gion,\n        \"TMin (\u00b0C)\" AS tmin,\n        \"TMax (\u00b0C)\" AS tmax,\n        \"TMoy (\u00b0C)\" AS tmoy\n    FROM \"dev\".\"main\".\"temp\"  -- Utilisation de la r\u00e9f\u00e9rence DBT pour la table temp\n),\nclean_data_with_temp AS (\n    -- Jointure entre la table clean et les donn\u00e9es de temp\u00e9rature\n    SELECT\n        c.\"Code INSEE r\u00e9gion\",\n        c.R\u00e9gion,\n        c.Date,\n        c.Heure,\n        c.consommation,\n        c.eolien,\n        c.thermique,\n        c.bioenergies,\n        c.nucleaire,\n        c.solaire,\n        c.hydraulique,\n        c.pompage,\n        c.ech_physiques,\n        c.production_totale,\n        t.tmin,  -- Utilisation de tmin ici\n        t.tmax,  -- Utilisation de tmax ici\n        t.tmoy   -- Utilisation de tmoy ici\n    FROM \"dev\".\"main\".\"clean\" c\n    LEFT JOIN temperature_data t\n        ON c.Date = t.Date\n        AND c.\"Code INSEE r\u00e9gion\" = t.code_insee_region  -- Correction : assurez-vous que les noms correspondent\n)\n-- Cr\u00e9ation d'une table finale avec les donn\u00e9es int\u00e9gr\u00e9es\nSELECT\n    \"Code INSEE r\u00e9gion\",\n    \"R\u00e9gion\",\n    Date,\n    Heure,\n    consommation,\n    eolien,\n    thermique,\n    bioenergies,\n    nucleaire,\n    solaire,\n    hydraulique,\n    pompage,\n    ech_physiques,\n    production_totale,\n    tmin,  -- Utilisation de tmin ici\n    tmax,  -- Utilisation de tmax ici\n    tmoy   -- Utilisation de tmoy ici\nFROM clean_data_with_temp", "relation_name": "\"dev\".\"main\".\"clean_temp\""}], "elapsed_time": 1.0089550018310547, "args": {"use_colors": true, "populate_cache": true, "version_check": true, "log_path": "/home/ETUDIANT/e24a518u/Bureau/tp sql/transform/logs", "empty": false, "show_resource_report": false, "log_level_file": "debug", "select": [], "project_dir": "/home/ETUDIANT/e24a518u/Bureau/tp sql/transform", "log_file_max_bytes": 10485760, "enable_legacy_logger": false, "log_level": "info", "partial_parse_file_diff": true, "which": "run", "defer": false, "exclude": [], "static_parser": true, "warn_error_options": {"include": [], "exclude": []}, "macro_debugging": false, "strict_mode": false, "profiles_dir": "/home/ETUDIANT/e24a518u/.dbt", "log_format": "default", "source_freshness_run_project_hooks": false, "send_anonymous_usage_stats": true, "invocation_command": "dbt run", "partial_parse": true, "cache_selected_only": false, "indirect_selection": "eager", "print": true, "introspect": true, "log_format_file": "debug", "printer_width": 80, "write_json": true, "favor_state": false, "quiet": false, "vars": {}, "require_resource_names_without_spaces": false, "require_explicit_package_overrides_for_builtin_materializations": true, "use_colors_file": true}}